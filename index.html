<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0, maximum-scale=1.0, user-scalable=no">
    <title>Secret Meet - Premium Chat</title>
    <script src="https://telegram.org/js/telegram-web-app.js"></script>
    <script src="/socket.io/socket.io.js"></script>
    <style>
        :root {
            --primary: #ff0080;
            --secondary: #7928ca;
            --bg-dark: #0a0b1e;
            --glass: rgba(255, 255, 255, 0.1);
            --text-main: #ffffff;
            --text-muted: #a0a0b8;
        }

        body { 
            background: radial-gradient(circle at top right, #1a1b3a, #0a0b1e); 
            color: var(--text-main); 
            font-family: 'Inter', -apple-system, sans-serif; 
            margin: 0; 
            overflow: hidden; 
            height: 100vh;
            /* ‡¶ï‡¶ø‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶ì‡¶™‡ßá‡¶® ‡¶π‡¶≤‡ßá ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤ ‡¶á‡¶∏‡ßç‡¶Ø‡ßÅ ‡¶†‡ßá‡¶ï‡¶æ‡¶®‡ßã‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø */
            position: fixed;
            width: 100%;
        }

        #app { display: flex; flex-direction: column; height: 100vh; height: -webkit-fill-available; }

        .header { 
            background: rgba(15, 12, 41, 0.8);
            backdrop-filter: blur(15px);
            padding: 15px; 
            text-align: center; 
            font-size: 1.1rem;
            font-weight: 800; 
            border-bottom: 1px solid rgba(255, 0, 128, 0.3);
            flex-shrink: 0;
        }

        #home-screen { 
            flex: 1; 
            display: flex; 
            flex-direction: column; 
            align-items: center; 
            justify-content: center; 
            padding: 30px;
            animation: fadeIn 0.8s ease;
        }

        #chat-screen { 
            flex: 1; 
            display: none; 
            flex-direction: column; 
            overflow: hidden; /* ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶ø‡¶® ‡¶Ø‡¶æ‡¶§‡ßá ‡¶®‡¶æ ‡¶®‡ßú‡ßá */
            position: relative;
        }
        
        #messages { 
            flex: 1; 
            overflow-y: auto; 
            padding: 15px; 
            display: flex; 
            flex-direction: column; 
            gap: 12px;
            /* ‡¶∏‡ßç‡¶Æ‡ßÅ‡¶• ‡¶∏‡ßç‡¶ï‡ßç‡¶∞‡¶≤‡¶ø‡¶Ç */
            scroll-behavior: smooth;
            -webkit-overflow-scrolling: touch;
        }

        .msg { 
            padding: 12px 18px; 
            border-radius: 18px; 
            max-width: 85%; 
            font-size: 15px; 
            line-height: 1.4; 
            word-wrap: break-word;
            animation: slideUp 0.3s ease;
        }
        .me { background: linear-gradient(135deg, var(--primary), var(--secondary)); align-self: flex-end; border-bottom-right-radius: 4px; }
        .partner { background: var(--glass); backdrop-filter: blur(10px); align-self: flex-start; border-bottom-left-radius: 4px; }

        .input-area { 
            padding: 10px 15px; 
            background: rgba(10, 11, 30, 0.95);
            display: flex; 
            gap: 10px;
            border-top: 1px solid rgba(255,255,255,0.1);
            flex-shrink: 0;
            padding-bottom: env(safe-area-inset-bottom, 10px);
        }

        input { 
            flex: 1; padding: 12px 20px; border-radius: 25px; 
            border: 1px solid rgba(255,255,255,0.1); background: rgba(255,255,255,0.05); 
            color: white; outline: none; font-size: 16px; /* ‡¶ï‡¶ø‡¶¨‡ßã‡¶∞‡ßç‡¶° ‡¶ú‡ßÅ‡¶Æ ‡¶π‡¶ì‡ßü‡¶æ ‡¶†‡ßá‡¶ï‡¶æ‡¶¨‡ßá */
        }

        .send-btn { background: var(--primary); color: white; border: none; width: 45px; height: 45px; border-radius: 50%; display: flex; align-items: center; justify-content: center; flex-shrink: 0;}

        .stop-chat { color: #ff4d4d; font-size: 13px; font-weight: 600; padding: 8px; background: transparent; border: none; cursor: pointer; flex-shrink: 0;}

        .end-options { 
            display: flex; flex-direction: column; gap: 10px;
            padding: 20px; background: rgba(255, 255, 255, 0.05); 
            backdrop-filter: blur(10px); border-radius: 20px; 
            margin: 10px 0; border: 1px solid rgba(255, 0, 128, 0.2);
            width: 100%; box-sizing: border-box;
        }
        .btn-next { background: #00d2ad; color: white; border: none; padding: 14px; border-radius: 15px; font-weight: 700; cursor: pointer; }
        .btn-exit { background: rgba(255, 255, 255, 0.1); color: white; border: none; padding: 14px; border-radius: 15px; font-weight: 700; cursor: pointer; }

        .status-msg { font-size: 12px; color: var(--text-muted); text-align: center; margin: 10px 0; }

        @keyframes slideUp { from { transform: translateY(10px); opacity: 0; } to { transform: translateY(0); opacity: 1; } }

        /* ‡¶´‡¶ü‡ßã ‡¶¨‡¶æ‡¶ü‡¶® ‡¶è‡¶¨‡¶Ç ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ */
.photo-btn {
    background: var(--glass);
    color: white;
    border: none;
    width: 45px;
    height: 45px;
    border-radius: 50%;
    display: flex;
    align-items: center;
    justify-content: center;
    cursor: pointer;
    font-size: 20px;
}
.chat-img-container {
    max-width: 200px; 
    height: 150px; /* ‡¶π‡¶æ‡¶á‡¶ü ‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶° ‡¶ï‡¶∞‡ßá ‡¶¶‡ßá‡¶ì‡ßü‡¶æ ‡¶π‡¶≤‡ßã ‡¶Ø‡¶æ‡¶§‡ßá ‡¶á‡¶â‡¶®‡¶ø‡¶´‡¶∞‡ßç‡¶Æ ‡¶¶‡ßá‡¶ñ‡¶æ‡ßü */
    border-radius: 12px;
    overflow: hidden; 
    margin-top: 5px;
    background: #000;
    border: 1px solid rgba(255, 255, 255, 0.1);
}

.chat-img {
    width: 100%;
    height: 100%;
    object-fit: cover; /* ‡¶õ‡¶¨‡¶ø ‡¶´‡ßá‡¶ü‡ßá ‡¶Ø‡¶æ‡¶¨‡ßá ‡¶®‡¶æ, ‡¶´‡ßç‡¶∞‡ßá‡¶Æ‡ßá‡¶∞ ‡¶≠‡ßá‡¶§‡¶∞ ‡¶´‡¶ø‡¶ü ‡¶π‡¶¨‡ßá */
    display: block;
}
        
    </style>
    <script src="https://sad.adsgram.ai/js/sad.min.js"></script>
    <script src='//libtl.com/sdk.js' data-zone='9341070' data-sdk='show_9341070'></script>
</head>
<body>
    <div id="app">
        <div class="header">üíñ SECRET MEET LIVE</div>
        
        <div id="home-screen">
            <div style="font-size: 60px; margin-bottom: 20px; filter: drop-shadow(0 0 15px var(--primary));">üé≠</div>
            <h1>Ready to Mingle?</h1>
            <p style="color: var(--text-muted); text-align: center;">Connect anonymously with random people.</p>
            <button class="btn-main" style="padding: 16px 50px; border-radius: 30px; border: none; background: linear-gradient(135deg, var(--primary), var(--secondary)); color: white; font-size: 17px; font-weight: 700; cursor: pointer; box-shadow: 0 8px 25px rgba(255, 0, 128, 0.4); margin-top: 20px;" id="findBtn" onclick="findPartner()">üîç Start Searching</button>
            <p id="status-text" style="margin-top: 20px; font-size: 14px; color: var(--primary);">‚óè Online & Ready</p>
        </div>

        <div id="chat-screen">
            <div id="messages"></div>
            <div id="stop-btn-container" style="text-align: center; background: rgba(10, 11, 30, 0.5);">
                <button class="stop-chat" onclick="endChatLocal()">Disconnect Chat</button>
            </div>
           <div class="input-area" id="input-container">
    <input type="file" id="fileInput" accept="image/*" style="display: none;" onchange="sendPhoto(this)">
    
    <button class="photo-btn" onclick="document.getElementById('fileInput').click()">üñºÔ∏è</button>
    <input id="minput" type="text" placeholder="Write a message..." onkeypress="if(event.key==='Enter') sendMsg()">
    <button class="send-btn" onclick="sendMsg()">‚û§</button>
</div>
        </div>
    </div>

    <div id="limit-modal" style="display:none; position:fixed; top:0; left:0; width:100%; height:100%; background:rgba(0,0,0,0.8); backdrop-filter:blur(8px); z-index:9999; align-items:center; justify-content:center;">
        <div style="background:linear-gradient(135deg, #1a1b3a, #0a0b1e); border: 1px solid var(--primary); padding:30px; border-radius:25px; width:80%; max-width:320px; text-align:center; box-shadow:0 0 30px rgba(255, 0, 128, 0.3); animation: slideUp 0.4s ease;">
            <div style="font-size:50px; margin-bottom:15px;">üö´</div>
            <h2 style="margin:0; color:var(--primary); font-size:22px;">Limit Reached!</h2>
            <p style="color:var(--text-muted); font-size:14px; margin:15px 0;">Your match limit is over. Check our Telegram bot to get more matches by inviting friends.</p>
            <button onclick="closeLimitModal()" style="background:linear-gradient(135deg, var(--primary), var(--secondary)); color:white; border:none; padding:12px 30px; border-radius:15px; font-weight:700; cursor:pointer; width:100%;">Got it!</button>
        </div>
    </div>

    <script>
    const tg = window.Telegram.WebApp;
    const socket = io({ transports: ['websocket'], upgrade: false });
    const userId = tg.initDataUnsafe?.user?.id;
    const AdController = window.Adsgram.init({ blockId: "int-11153" });

    tg.expand();
    tg.ready();

    if (userId) socket.emit('join', userId);

    // ‡¶°‡ßÅ‡¶™‡ßç‡¶≤‡¶ø‡¶ï‡ßá‡¶ü ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶†‡ßá‡¶ï‡¶æ‡¶§‡ßá ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞ ‡¶ï‡ßç‡¶≤‡¶ø‡¶® ‡¶ï‡¶∞‡¶æ‡¶∞ ‡¶´‡¶æ‡¶Ç‡¶∂‡¶®
    function setupSocketListeners() {
        socket.off('receive_msg');
        socket.off('chat_ended');

        socket.on('receive_msg', (data) => {
            if (data.image) {
                addImageMessage(data.image, 'partner');
            } else if (data.text) {
                addMessage(data.text, 'partner');
            }
            tg.HapticFeedback.notificationOccurred('success');
        });

        socket.on('chat_ended', () => {
            addStatusMessage("üö´ Partner left the chat.");
            showEndControls();
        });
    }

    function findPartner() {
        if (!userId) return;
        AdController.show().then(() => startSearchingLogic()).catch(() => startSearchingLogic());
    }

    function startSearchingLogic() {
        document.getElementById('status-text').innerText = "‚ö° Searching...";
        document.getElementById('findBtn').disabled = true;
        document.getElementById('findBtn').style.opacity = "0.5";
        socket.emit('find_partner_web', userId); 
    }

    socket.on('match_found', () => {
        document.getElementById('input-container').style.display = 'flex';
        document.getElementById('stop-btn-container').style.display = 'block';
        document.getElementById('home-screen').style.display = 'none';
        document.getElementById('chat-screen').style.display = 'flex';
        document.getElementById('messages').innerHTML = "";
        
        setupSocketListeners(); // ‡¶Æ‡ßç‡¶Ø‡¶æ‡¶ö ‡¶π‡¶≤‡ßá ‡¶≤‡¶ø‡¶∏‡ßá‡¶®‡¶æ‡¶∞ ‡¶∏‡ßá‡¶ü‡¶Ü‡¶™ ‡¶π‡¶¨‡ßá
        addStatusMessage("‚ú® Match found! Say hello.");
    });

    function sendMsg() {
        const inp = document.getElementById('minput');
        if (!inp.value.trim()) return;
        addMessage(inp.value, 'me');
        socket.emit('send_msg', { senderId: userId, text: inp.value });
        inp.value = '';
        inp.focus();
    }

    function sendPhoto(input) {
        if (input.files && input.files[0]) {
            const reader = new FileReader();
            reader.onload = function (e) {
                const imageData = e.target.result;
                addImageMessage(imageData, 'me');
                socket.emit('send_msg', { senderId: userId, image: imageData });
            };
            reader.readAsDataURL(input.files[0]);
            input.value = ""; 
        }
    }

    function addMessage(text, type) {
        const div = document.createElement('div');
        div.className = `msg ${type}`;
        div.innerText = text;
        document.getElementById('messages').appendChild(div);
        scrollDown();
    }

    // ‡¶á‡¶Æ‡ßá‡¶ú ‡¶Æ‡ßá‡¶∏‡ßá‡¶ú ‡¶¶‡ßá‡¶ñ‡¶æ‡¶®‡ßã‡¶∞ ‡¶è‡¶ï‡¶ï ‡¶´‡¶æ‡¶Ç‡¶∂‡¶® (‡¶´‡¶ø‡¶ï‡ßç‡¶∏‡¶° ‡¶∏‡¶æ‡¶á‡¶ú ‡¶∏‡¶π)
    function addImageMessage(src, type) {
        const div = document.createElement('div');
        div.className = `msg ${type}`;
        
        const imgContainer = document.createElement('div');
        imgContainer.className = 'chat-img-container';

        const img = document.createElement('img');
        img.src = src;
        img.className = 'chat-img';
        // ‡¶™‡ßç‡¶∞‡¶ø‡¶≠‡¶ø‡¶â ‡¶è‡¶∞ ‡¶ú‡¶®‡ßç‡¶Ø ‡¶ü‡ßá‡¶≤‡¶ø‡¶ó‡ßç‡¶∞‡¶æ‡¶Æ ‡¶∏‡ßç‡¶ü‡¶æ‡¶á‡¶≤ ‡¶™‡¶™‡¶Ü‡¶™ (‡¶Ö‡¶™‡¶∂‡¶®‡¶æ‡¶≤)
        img.onclick = () => tg.showPopup({ title: 'Image View', message: 'Viewing shared image.' });
        
        imgContainer.appendChild(img);
        div.appendChild(imgContainer);
        document.getElementById('messages').appendChild(div);
        scrollDown();
    }

    function endChatLocal() {
        if (userId) socket.emit('leave_chat', userId);
        addStatusMessage("üîí You closed the chat.");
        showEndControls();
    }

    function showEndControls() {
        document.getElementById('input-container').style.display = 'none';
        document.getElementById('stop-btn-container').style.display = 'none';
        const old = document.getElementById('end-options-ui');
        if(old) old.remove();

        const controlDiv = document.createElement('div');
        controlDiv.className = 'end-options';
        controlDiv.id = 'end-options-ui';
        controlDiv.innerHTML = `
            <button class="btn-next" onclick="findNextPartner()">üîç Find Next Person</button>
            <button class="btn-exit" onclick="location.reload()">üè† Return Home</button>
        `;
        document.getElementById('messages').appendChild(controlDiv);
        setTimeout(scrollDown, 100);
    }

    function findNextPartner() {
        document.getElementById('chat-screen').style.display = 'none';
        document.getElementById('home-screen').style.display = 'flex';
        document.getElementById('findBtn').disabled = false;
        document.getElementById('findBtn').style.opacity = "1";
        findPartner();
    }

    function addStatusMessage(text) {
        const p = document.createElement('p');
        p.className = 'status-msg';
        p.innerText = text;
        document.getElementById('messages').appendChild(p);
        scrollDown();
    }

    function scrollDown() {
        const container = document.getElementById('messages');
        container.scrollTop = container.scrollHeight;
    }

    socket.on('limit_over', () => {
        document.getElementById('status-text').innerText = "‚ùå Limit Over! Check Bot.";
        document.getElementById('findBtn').disabled = false;
        document.getElementById('findBtn').style.opacity = "1";
        document.getElementById('limit-modal').style.display = 'flex';
    });

    function closeLimitModal() {
        document.getElementById('limit-modal').style.display = 'none';
    }

    if(window.show_9341070) {
        show_9341070({
            type: 'inApp',
            inAppSettings: { frequency: 2, capping: 0.3, interval: 300, timeout: 30, everyPage: false }
        });
    }
</script>
</body>
</html>
